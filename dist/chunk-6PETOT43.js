'use client'
import{b as g}from"./chunk-XORGXZGQ.js";import io from"@tiptap/starter-kit";import Be from"@tiptap/extension-horizontal-rule";import mo from"@tiptap/extension-link";import co from"@tiptap/extension-image";import ke from"@tiptap/extension-placeholder";import Ae from"@tiptap/extension-underline";import Oe from"@tiptap/extension-text-style";import{Color as We}from"@tiptap/extension-color";import{Markdown as ze}from"tiptap-markdown";import Ke from"@tiptap/extension-highlight";import A from"@tiptap/extension-image";var O=A.extend({name:"updated-image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),W=O;import{Extension as z}from"@tiptap/core";var K=z.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:e,commands:t})=>{let{state:o}=e,{tr:r}=o,i=r.selection.$from.start(),a=r.selection.$to.end();return t.setTextSelection({from:i,to:a})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:e})=>{let{state:t}=e,{tr:o}=t,r=o.selection.from,i=o.selection.to,a=o.selection.$from.start(),n=o.selection.$to.end();return r>a||i<n?(e.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),R=K;import{Extension as U}from"@tiptap/core";import{NodeSelection as C,Plugin as $}from"@tiptap/pm/state";import{__serializeForClipboard as X}from"@tiptap/pm/view";function q(e){let t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width}}function h(e){return document.elementsFromPoint(e.x,e.y).find(t=>t.parentElement?.matches?.(".ProseMirror")||t.matches(["li","p:not(:first-child)","pre","blockquote","h1, h2, h3, h4, h5, h6"].join(", ")))}function P(e,t,o){let r=e.getBoundingClientRect();return t.posAtCoords({left:r.left+50+o.dragHandleWidth,top:r.top+1})?.inside}function V(e){function t(n,s){if(s.focus(),!n.dataTransfer)return;let d=h({x:n.clientX+50+e.dragHandleWidth,y:n.clientY});if(!(d instanceof Element))return;let m=P(d,s,e);if(m==null||m<0)return;s.dispatch(s.state.tr.setSelection(C.create(s.state.doc,m)));let c=s.state.selection.content(),{dom:p,text:l}=X(s,c);n.dataTransfer.clearData(),n.dataTransfer.setData("text/html",p.innerHTML),n.dataTransfer.setData("text/plain",l),n.dataTransfer.effectAllowed="copyMove",n.dataTransfer.setDragImage(d,0,0),s.dragging={slice:c,move:n.ctrlKey}}function o(n,s){s.focus(),s.dom.classList.remove("dragging");let d=h({x:n.clientX+50+e.dragHandleWidth,y:n.clientY});if(!(d instanceof Element))return;let m=P(d,s,e);m&&s.dispatch(s.state.tr.setSelection(C.create(s.state.doc,m)))}let r=null;function i(){r&&r.classList.add("hide")}function a(){r&&r.classList.remove("hide")}return new $({view:n=>(r=document.createElement("div"),r.draggable=!0,r.dataset.dragHandle="",r.classList.add("drag-handle"),r.addEventListener("dragstart",s=>{t(s,n)}),r.addEventListener("click",s=>{o(s,n)}),i(),n?.dom?.parentElement?.appendChild(r),{destroy:()=>{r?.remove?.(),r=null}}),props:{handleDOMEvents:{mousemove:(n,s)=>{if(!n.editable)return;let d=h({x:s.clientX+50+e.dragHandleWidth,y:s.clientY});if(!(d instanceof Element)){i();return}let m=window.getComputedStyle(d),c=parseInt(m.lineHeight,10),p=parseInt(m.paddingTop,10),l=q(d);l.top+=(c-24)/2,l.top+=p,d.matches("ul:not([data-type=taskList]) li, ol li")&&(l.left-=e.dragHandleWidth),l.width=e.dragHandleWidth,r&&(r.style.left=`${l.left-l.width}px`,r.style.top=`${l.top}px`,a())},keydown:()=>{i()},mousewheel:()=>{i()},dragstart:n=>{n.dom.classList.add("dragging")},drop:n=>{n.dom.classList.remove("dragging")},dragend:n=>{n.dom.classList.remove("dragging")}}}})}var _=U.create({name:"dragAndDrop",addProseMirrorPlugins(){return[V({dragHandleWidth:24})]}}),S=_;import Te from"react-moveable";import{useCurrentEditor as B}from"@tiptap/react";import{}from"@tiptap/core";import{useMemo as J,forwardRef as Y}from"react";import{EditorProvider as F}from"@tiptap/react";import{Provider as Q,createStore as G}from"jotai";import"@tiptap/core";import{jsx as E}from"react/jsx-runtime";var u=G(),Z=({children:e})=>E(Q,{store:u,children:e}),j=Y(({className:e,children:t,initialContent:o,...r},i)=>{let a=J(()=>[...D,...r.extensions??[]],[r.extensions]);return E("div",{ref:i,className:e,children:E(F,{...r,content:o,extensions:a,children:t})})}),ee={handleDOMEvents:{keydown:(e,t)=>{if(["ArrowUp","ArrowDown","Enter"].includes(t.key)&&document.querySelector("#slash-command"))return!0}},handlePaste:(e,t)=>{if(t.clipboardData&&t.clipboardData.files&&t.clipboardData.files[0]){t.preventDefault();let o=t.clipboardData.files[0],r=e.state.selection.from;return g(o,e,r),!0}return!1},handleDrop:(e,t,o,r)=>{if(!r&&t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]){t.preventDefault();let i=t.dataTransfer.files[0],a=e.posAtCoords({left:t.clientX,top:t.clientY});return g(i,e,a?.pos||-1),!0}return!1}};import{BubbleMenu as te,isNodeSelection as oe,useCurrentEditor as re}from"@tiptap/react";import{useMemo as ne,useRef as ie,useEffect as ae,forwardRef as se}from"react";import{jsx as T}from"react/jsx-runtime";var de=se(({children:e,tippyOptions:t,...o},r)=>{let{editor:i}=re(),a=ie(null);ae(()=>{!a.current||!t?.placement||(a.current.setProps({placement:t.placement}),a.current.popperInstance?.update())},[t?.placement]);let n=ne(()=>({shouldShow:({editor:d,state:m})=>{let{selection:c}=m,{empty:p}=c;return!(d.isActive("image")||p||oe(c))},tippyOptions:{onCreate:d=>{a.current=d},moveTransition:"transform 0.15s ease-out",...t},...o}),[o,t]);return i?T("div",{ref:r,children:T(te,{editor:i,...n,children:e})}):null});import{forwardRef as me}from"react";import{Slot as le}from"@radix-ui/react-slot";import{useCurrentEditor as ce}from"@tiptap/react";import{jsx as pe}from"react/jsx-runtime";var I=me(({children:e,asChild:t,onSelect:o,...r},i)=>{let{editor:a}=ce(),n=t?le:"div";return a?pe(n,{ref:i,...r,onClick:()=>o?.(a),children:e}):null});I.displayName="EditorBubbleItem";import{atom as M,useAtom as ue,useSetAtom as w}from"jotai";import{useEffect as y,useRef as fe,forwardRef as ge}from"react";import he from"tunnel-rat";import{Command as b}from"cmdk";import{jsx as f,jsxs as ye}from"react/jsx-runtime";var N=he(),H=M(""),x=M(null),v=({query:e,range:t})=>{let o=w(H,{store:u}),r=w(x,{store:u});return y(()=>{o(e)},[e,o]),y(()=>{r(t)},[t,r]),y(()=>{let i=["ArrowUp","ArrowDown","Enter"],a=n=>{if(i.includes(n.key)){n.preventDefault();let s=document.querySelector("#slash-command");return s&&s.dispatchEvent(new KeyboardEvent("keydown",{key:n.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[]),f(N.Out,{})},Ee=ge(({children:e,className:t,...o},r)=>{let i=fe(null),[a,n]=ue(H);return f(N.In,{children:ye(b,{ref:r,onKeyDown:s=>{s.stopPropagation()},id:"slash-command",className:t,...o,children:[f(b.Input,{value:a,onValueChange:n,style:{display:"none"}}),f(b.List,{ref:i,children:e})]})})});import{forwardRef as be}from"react";import{CommandEmpty as xe,CommandItem as Re}from"cmdk";import"@tiptap/core";import{useCurrentEditor as Ce}from"@tiptap/react";import{useAtomValue as Pe}from"jotai";import{jsx as De}from"react/jsx-runtime";var L=be(({children:e,onCommand:t,...o},r)=>{let{editor:i}=Ce(),a=Pe(x);return!i||!a?null:De(Re,{ref:r,...o,onSelect:()=>t({editor:i,range:a}),children:e})});L.displayName="EditorCommandItem";var Se=xe;import{Fragment as we,jsx as k}from"react/jsx-runtime";var Ie=()=>{let{editor:e}=B();if(!e?.isActive("image"))return null;let t=()=>{let o=document.querySelector(".ProseMirror-selectednode");if(o){let r=e.state.selection,i=e.commands.setImage;i({src:o.src,width:Number(o.style.width.replace("px","")),height:Number(o.style.height.replace("px",""))}),e.commands.setNodeSelection(r.from)}};return k(we,{children:k(Te,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:o,width:r,height:i,delta:a})=>{a[0]&&(o.style.width=`${r}px`),a[1]&&(o.style.height=`${i}px`)},onResizeEnd:()=>{t()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:o,transform:r})=>{o.style.transform=r}})})};import{TaskItem as Po}from"@tiptap/extension-task-item";import{TaskList as Do}from"@tiptap/extension-task-list";import{InputRule as Ue}from"@tiptap/core";import{Extension as Me}from"@tiptap/core";import Ne from"@tiptap/suggestion";import{ReactRenderer as He}from"@tiptap/react";import ve from"tippy.js";var Gt=Me.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:e,range:t,props:o})=>{o.command({editor:e,range:t})}}}},addProseMirrorPlugins(){return[Ne({editor:this.editor,...this.options.suggestion})]}}),Zt=()=>{let e=null,t=null;return{onStart:o=>{e=new He(v,{props:o,editor:o.editor}),t=ve("body",{getReferenceClientRect:o.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:o=>{e?.updateProps(o),t&&t[0].setProps({getReferenceClientRect:o.clientRect})},onKeyDown:o=>o.event.key==="Escape"?(t?.[0].hide(),!0):e?.ref?.onKeyDown(o),onExit:()=>{t?.[0].destroy(),e?.destroy()}}},jt=e=>e;import"@tiptap/core";var Le=(e,{chars:t,offset:o=0})=>e.state.doc.textBetween(Math.max(0,e.state.selection.from-t),e.state.selection.from-o,`
`);var Io=ke.configure({placeholder:({node:e})=>e.type.name==="heading"?`Heading ${e.attrs.level}`:"Press '/' for commands",includeChildren:!0}),D=[Ae,Oe,We,Ke.configure({multicolor:!0}),ze.configure({html:!1,transformCopiedText:!0}),R,S],wo=Be.extend({addInputRules(){return[new Ue({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/,handler:({state:e,range:t})=>{let o={},{tr:r}=e,i=t.from,a=t.to;r.insert(i-1,this.type.create(o)).delete(r.mapping.map(i),r.mapping.map(a))}})]}});export{W as a,Ie as b,Ee as c,Gt as d,Zt as e,jt as f,Le as g,io as h,mo as i,co as j,Po as k,Do as l,Ue as m,Io as n,D as o,wo as p,Z as q,j as r,ee as s,de as t,I as u,L as v,Se as w,B as x};
