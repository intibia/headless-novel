'use client'
var de=Object.create;var E=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var me=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var ue=(e,o)=>{for(var t in o)E(e,t,{get:o[t],enumerable:!0})},N=(e,o,t,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let i of me(o))!pe.call(e,i)&&i!==t&&E(e,i,{get:()=>o[i],enumerable:!(r=le(o,i))||r.enumerable});return e};var d=(e,o,t)=>(t=e!=null?de(ce(e)):{},N(o||!e||!e.__esModule?E(t,"default",{value:e,enumerable:!0}):t,e)),fe=e=>N(E({},"__esModule",{value:!0}),e);var Te={};ue(Te,{Command:()=>be,HorizontalRule:()=>Se,ImageResizer:()=>q,InputRule:()=>H.InputRule,Placeholder:()=>De,StarterKit:()=>Q.default,TaskItem:()=>ie.TaskItem,TaskList:()=>se.TaskList,TiptapImage:()=>j.default,TiptapLink:()=>Z.default,UpdatedImage:()=>L,createSuggestionItems:()=>Pe,getPrevText:()=>F,renderItems:()=>Ce,simpleExtensions:()=>T});module.exports=fe(Te);var Q=d(require("@tiptap/starter-kit"),1),G=d(require("@tiptap/extension-horizontal-rule"),1),Z=d(require("@tiptap/extension-link"),1),j=d(require("@tiptap/extension-image"),1),ee=d(require("@tiptap/extension-placeholder"),1),te=d(require("@tiptap/extension-underline"),1),oe=d(require("@tiptap/extension-text-style"),1),re=require("@tiptap/extension-color"),ne=require("tiptap-markdown"),ae=d(require("@tiptap/extension-highlight"),1);var I=d(require("@tiptap/extension-image"),1),ge=I.default.extend({name:"updated-image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),L=ge;var M=require("@tiptap/core"),he=M.Extension.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:e,commands:o})=>{let{state:t}=e,{tr:r}=t,i=r.selection.$from.start(),s=r.selection.$to.end();return o.setTextSelection({from:i,to:s})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:e})=>{let{state:o}=e,{tr:t}=o,r=t.selection.from,i=t.selection.to,s=t.selection.$from.start(),n=t.selection.$to.end();return r>s||i<n?(e.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),k=he;var A=require("@tiptap/core"),g=require("@tiptap/pm/state"),v=require("@tiptap/pm/view");function ye(e){let o=e.getBoundingClientRect();return{top:o.top,left:o.left,width:o.width}}function C(e){return document.elementsFromPoint(e.x,e.y).find(o=>o.parentElement?.matches?.(".ProseMirror")||o.matches(["li","p:not(:first-child)","pre","blockquote","h1, h2, h3, h4, h5, h6"].join(", ")))}function O(e,o,t){let r=e.getBoundingClientRect();return o.posAtCoords({left:r.left+50+t.dragHandleWidth,top:r.top+1})?.inside}function Ee(e){function o(n,a){if(a.focus(),!n.dataTransfer)return;let l=C({x:n.clientX+50+e.dragHandleWidth,y:n.clientY});if(!(l instanceof Element))return;let m=O(l,a,e);if(m==null||m<0)return;a.dispatch(a.state.tr.setSelection(g.NodeSelection.create(a.state.doc,m)));let y=a.state.selection.content(),{dom:b,text:c}=(0,v.__serializeForClipboard)(a,y);n.dataTransfer.clearData(),n.dataTransfer.setData("text/html",b.innerHTML),n.dataTransfer.setData("text/plain",c),n.dataTransfer.effectAllowed="copyMove",n.dataTransfer.setDragImage(l,0,0),a.dragging={slice:y,move:n.ctrlKey}}function t(n,a){a.focus(),a.dom.classList.remove("dragging");let l=C({x:n.clientX+50+e.dragHandleWidth,y:n.clientY});if(!(l instanceof Element))return;let m=O(l,a,e);m&&a.dispatch(a.state.tr.setSelection(g.NodeSelection.create(a.state.doc,m)))}let r=null;function i(){r&&r.classList.add("hide")}function s(){r&&r.classList.remove("hide")}return new g.Plugin({view:n=>(r=document.createElement("div"),r.draggable=!0,r.dataset.dragHandle="",r.classList.add("drag-handle"),r.addEventListener("dragstart",a=>{o(a,n)}),r.addEventListener("click",a=>{t(a,n)}),i(),n?.dom?.parentElement?.appendChild(r),{destroy:()=>{r?.remove?.(),r=null}}),props:{handleDOMEvents:{mousemove:(n,a)=>{if(!n.editable)return;let l=C({x:a.clientX+50+e.dragHandleWidth,y:a.clientY});if(!(l instanceof Element)){i();return}let m=window.getComputedStyle(l),y=parseInt(m.lineHeight,10),b=parseInt(m.paddingTop,10),c=ye(l);c.top+=(y-24)/2,c.top+=b,l.matches("ul:not([data-type=taskList]) li, ol li")&&(c.left-=e.dragHandleWidth),c.width=e.dragHandleWidth,r&&(r.style.left=`${c.left-c.width}px`,r.style.top=`${c.top}px`,s())},keydown:()=>{i()},mousewheel:()=>{i()},dragstart:n=>{n.dom.classList.add("dragging")},drop:n=>{n.dom.classList.remove("dragging")},dragend:n=>{n.dom.classList.remove("dragging")}}}})}var xe=A.Extension.create({name:"dragAndDrop",addProseMirrorPlugins(){return[Ee({dragHandleWidth:24})]}}),z=xe;var X=d(require("react-moveable"),1);var w=require("@tiptap/react"),qe=require("@tiptap/core");var x=require("react"),K=require("@tiptap/react"),D=require("jotai");var ve=require("@tiptap/core"),P=require("react/jsx-runtime"),S=(0,D.createStore)();var Ke=(0,x.forwardRef)(({className:e,children:o,initialContent:t,...r},i)=>{let s=(0,x.useMemo)(()=>[...T,...r.extensions??[]],[r.extensions]);return(0,P.jsx)("div",{ref:i,className:e,children:(0,P.jsx)(K.EditorProvider,{...r,content:t,extensions:s,children:o})})});var u=require("jotai"),p=require("react"),W=d(require("tunnel-rat"),1);var R=require("cmdk"),f=require("react/jsx-runtime"),U=(0,W.default)(),$=(0,u.atom)(""),Re=(0,u.atom)(null),B=({query:e,range:o})=>{let t=(0,u.useSetAtom)($,{store:S}),r=(0,u.useSetAtom)(Re,{store:S});return(0,p.useEffect)(()=>{t(e)},[e,t]),(0,p.useEffect)(()=>{r(o)},[o,r]),(0,p.useEffect)(()=>{let i=["ArrowUp","ArrowDown","Enter"],s=n=>{if(i.includes(n.key)){n.preventDefault();let a=document.querySelector("#slash-command");return a&&a.dispatchEvent(new KeyboardEvent("keydown",{key:n.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[]),(0,f.jsx)(U.Out,{})},$e=(0,p.forwardRef)(({children:e,className:o,...t},r)=>{let i=(0,p.useRef)(null),[s,n]=(0,u.useAtom)($);return(0,f.jsx)(U.In,{children:(0,f.jsxs)(R.Command,{ref:r,onKeyDown:a=>{a.stopPropagation()},id:"slash-command",className:o,...t,children:[(0,f.jsx)(R.Command.Input,{value:s,onValueChange:n,style:{display:"none"}}),(0,f.jsx)(R.Command.List,{ref:i,children:e})]})})});var h=require("react/jsx-runtime"),q=()=>{let{editor:e}=(0,w.useCurrentEditor)();if(!e?.isActive("image"))return null;let o=()=>{let t=document.querySelector(".ProseMirror-selectednode");if(t){let r=e.state.selection,i=e.commands.setImage;i({src:t.src,width:Number(t.style.width.replace("px","")),height:Number(t.style.height.replace("px",""))}),e.commands.setNodeSelection(r.from)}};return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(X.default,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:t,width:r,height:i,delta:s})=>{s[0]&&(t.style.width=`${r}px`),s[1]&&(t.style.height=`${i}px`)},onResizeEnd:()=>{o()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:t,transform:r})=>{t.style.transform=r}})})};var ie=require("@tiptap/extension-task-item"),se=require("@tiptap/extension-task-list"),H=require("@tiptap/core");var _=require("@tiptap/core"),J=d(require("@tiptap/suggestion"),1),V=require("@tiptap/react"),Y=d(require("tippy.js"),1);var be=_.Extension.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:e,range:o,props:t})=>{t.command({editor:e,range:o})}}}},addProseMirrorPlugins(){return[(0,J.default)({editor:this.editor,...this.options.suggestion})]}}),Ce=()=>{let e=null,o=null;return{onStart:t=>{e=new V.ReactRenderer(B,{props:t,editor:t.editor}),o=(0,Y.default)("body",{getReferenceClientRect:t.clientRect,appendTo:()=>document.body,content:e.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:t=>{e?.updateProps(t),o&&o[0].setProps({getReferenceClientRect:t.clientRect})},onKeyDown:t=>t.event.key==="Escape"?(o?.[0].hide(),!0):e?.ref?.onKeyDown(t),onExit:()=>{o?.[0].destroy(),e?.destroy()}}},Pe=e=>e;var Fe=require("@tiptap/core");var F=(e,{chars:o,offset:t=0})=>e.state.doc.textBetween(Math.max(0,e.state.selection.from-o),e.state.selection.from-t,`
`);var De=ee.default.configure({placeholder:({node:e})=>e.type.name==="heading"?`Heading ${e.attrs.level}`:"Press '/' for commands",includeChildren:!0}),T=[te.default,oe.default,re.Color,ae.default.configure({multicolor:!0}),ne.Markdown.configure({html:!1,transformCopiedText:!0}),k,z],Se=G.default.extend({addInputRules(){return[new H.InputRule({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/,handler:({state:e,range:o})=>{let t={},{tr:r}=e,i=o.from,s=o.to;r.insert(i-1,this.type.create(t)).delete(r.mapping.map(i),r.mapping.map(s))}})]}});0&&(module.exports={Command,HorizontalRule,ImageResizer,InputRule,Placeholder,StarterKit,TaskItem,TaskList,TiptapImage,TiptapLink,UpdatedImage,createSuggestionItems,getPrevText,renderItems,simpleExtensions});
