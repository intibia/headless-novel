'use client'
import{Plugin as m,PluginKey as g}from"@tiptap/pm/state";import{Decoration as f,DecorationSet as h}from"@tiptap/pm/view";var s=new g("upload-image"),x=()=>new m({key:s,state:{init(){return h.empty},apply(t,e){e=e.map(t.mapping,t.doc);let n=t.getMeta(this);if(n&&n.add){let{id:o,pos:r,src:a}=n.add,d=document.createElement("div");d.setAttribute("class","img-placeholder");let i=document.createElement("img");i.setAttribute("class","opacity-40 rounded-lg border border-stone-200"),i.src=a,d.appendChild(i);let c=f.widget(r+1,d,{id:o});e=e.add(t.doc,[c])}else n&&n.remove&&(e=e.remove(e.find(null,null,o=>o.id==n.remove.id)));return e}},props:{decorations(t){return this.getState(t)}}});function y(t,e){let o=s.getState(t).find(null,null,r=>r.id==e);return o.length?o[0].from:null}function A(t,e,n){if(t.type.includes("image/")){if(t.size/1024/1024>20)return}else return;let o={},r=e.state.tr;r.selection.empty||r.deleteSelection();let a=new FileReader;a.readAsDataURL(t),a.onload=()=>{r.setMeta(s,{add:{id:o,pos:n,src:a.result}}),e.dispatch(r)},S(t).then(d=>{let{schema:i}=e.state,c=y(e.state,o);if(c==null)return;let l=typeof d=="object"?a.result:d,p=i.nodes.image.create({src:l}),u=e.state.tr.replaceWith(c,c,p).setMeta(s,{remove:{id:o}});e.dispatch(u)})}var S=t=>{};export{x as a,A as b,S as c};
